<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Screen Sharing</title>
    <script src="https://unpkg.com/peerjs@1.3.2/dist/peerjs.min.js"></script>
</head>
<style>
/* Estilos generales */
body {
    font-family: 'Poppins', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
}

/* T√≠tulos */
h1, h2 {
    text-align: center;
    margin-bottom: 10px;
}

/* Input para ingresar el ID */
input {
    font-size: 1rem;
    padding: 8px;
    margin: 10px;
    border: 2px solid #ffcc00;
    border-radius: 8px;
    outline: none;
    text-align: center;
}

/* Botones */
button {
    font-size: 1rem;
    font-weight: bold;
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
}

#startSharing {
    background: #ff5722;
    color: white;
}

#startCamera {
    background: #009688;
    color: white;
}

#playVideoButton {
    background: #ffcc00;
    color: #333;
}

button:hover {
    transform: scale(1.1);
    opacity: 0.8;
}

/* Contenedor de videos */
.video-container {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    width: 90%;
    max-width: 900px;
    margin-top: 20px;
}

/* Videos */
video {
    width: 55%;
    box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.5);
}

.explicacion{
    font-size: 1.2rem;
    margin: 10rem 2rem 0 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: left;
    width: 55%;

}



</style>

<body>
    <h1>WebRTC - Compartir y Recibir Pantalla</h1>

    <p>Tu ID de Peer: <span id="peerId">Esperando...</span></p>
    <input type="text" id="peerIdInput" placeholder="Ingresa el ID de otro usuario">

    <button id="startSharing">Iniciar Compartici√≥n</button>
    <button id="startCamera"> Compartir C√°mara</button>
    <button id="playVideoButton" style="display: none;">‚ñ∂ Reproducir Video</button>

    <h2>Tu pantalla compartida</h2>
    <video id="localVideo" autoplay playsinline muted></video>

    <h2>Pantalla recibida desde otra pesta√±a</h2>
    <video id="remoteVideo" autoplay playsinline></video>

    <div class="explicacion">
        <h2>üìå ¬øC√≥mo funciona WebRTC con RTCPeerConnection y BroadcastChannel?</h2>
        <p>
            WebRTC permite la comunicaci√≥n de video, audio y datos entre navegadores sin necesidad de un servidor
            intermedio.
            Para lograrlo, utilizamos <code>RTCPeerConnection</code> para establecer una conexi√≥n entre dos pesta√±as y
            <code>BroadcastChannel</code> para intercambiar mensajes de se√±alizaci√≥n entre ellas.
        </p>

        <h3>üì° Proceso de conexi√≥n</h3>
        <ol>
            <li>Una pesta√±a inicia la compartici√≥n de pantalla usando
                <code>navigator.mediaDevices.getDisplayMedia()</code>.
            </li>
            <li>Se crea un objeto <code>RTCPeerConnection</code> para gestionar la conexi√≥n WebRTC.</li>
            <li>El emisor crea una <strong>oferta (offer)</strong> y la env√≠a a trav√©s de <code>BroadcastChannel</code>
                a otras pesta√±as.</li>
            <li>Las pesta√±as receptoras reciben la oferta, crean una <strong>respuesta (answer)</strong> y la env√≠an de
                vuelta.</li>
            <li>Ambos navegadores intercambian <strong>candidatos ICE</strong> para establecer la conexi√≥n directa.</li>
            <li>Una vez establecida la conexi√≥n, la pantalla compartida se muestra en la pesta√±a receptora.</li>
        </ol>

        <h3>üîÑ ¬øQu√© son las ofertas, respuestas y candidatos ICE?</h3>
        <ul>
            <li><strong>Offer (Oferta):</strong> La pesta√±a que inicia la conexi√≥n crea una oferta SDP y la env√≠a al
                receptor.</li>
            <li><strong>Answer (Respuesta):</strong> La pesta√±a receptora responde con una descripci√≥n SDP.</li>
            <li><strong>ICE Candidates:</strong> Son los datos de red que permiten conectar las dos pesta√±as a trav√©s de
                Internet.</li>
        </ul>

        <h3>üí° ¬øPor qu√© usamos BroadcastChannel?</h3>
        <p>
            <code>BroadcastChannel</code> permite la comunicaci√≥n entre pesta√±as abiertas en el mismo navegador.
            En este caso, lo usamos para intercambiar la oferta, la respuesta y los candidatos ICE, lo que permite
            establecer una conexi√≥n WebRTC sin necesidad de un servidor externo.
        </p>

        <h3>üöÄ C√≥digo de Ejemplo</h3>
        <pre>
<code>
// Crear una conexi√≥n WebRTC
const peerConnection = new RTCPeerConnection();

// Crear un canal de comunicaci√≥n entre pesta√±as
const signalingChannel = new BroadcastChannel('webrtc-signaling');

// Enviar oferta cuando se inicia la compartici√≥n
async function startConnection() {
    const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
    stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));

    const offer = await peerConnection.createOffer();
    await peerConnection.setLocalDescription(offer);

    signalingChannel.postMessage({ type: 'offer', offer });
}

// Manejar mensajes de la otra pesta√±a
signalingChannel.onmessage = async (event) => {
    if (event.data.type === 'offer') {
        await peerConnection.setRemoteDescription(new RTCSessionDescription(event.data.offer));
        const answer = await peerConnection.createAnswer();
        await peerConnection.setLocalDescription(answer);
        signalingChannel.postMessage({ type: 'answer', answer });
    }
};
</code>
</pre>

        <h3>üìö Bibliograf√≠a</h3>
        <p>
            Para m√°s informaci√≥n sobre WebRTC y sus funcionalidades, puedes consultar la documentaci√≥n oficial y
            ejemplos en:
        </p>
        <ul>
            <li><a href="https://webrtc.github.io/samples/" target="_blank">WebRTC GitHub Samples</a></li>
        </ul>
    </div>


    <script src="version_04.js"></script>
</body>

</html>